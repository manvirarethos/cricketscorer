<!-- Match Setup Screen -->
<app-setup-screen *ngIf="!matchSetup()" (setupComplete)="handleMatchSetup($event)"></app-setup-screen>

<!-- Main Scoring Screen -->
<div *ngIf="matchSetup()" class="scorer-container">
    <div class="container">

        <!-- Match Header -->
        <div class="match-header">
            <div class="match-info">
                <h1 class="match-title">{{ matchSetup()!.team1 }} vs {{ matchSetup()!.team2 }}</h1>
                <div class="match-details">
                    <span class="detail-item">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M12 22s-8-4.5-8-11.8A8 8 0 0 1 12 2a8 8 0 0 1 8 8.2c0 7.3-8 11.8-8 11.8z"/>
                            <circle cx="12" cy="10" r="3"/>
                        </svg>
                        {{ matchSetup()!.location }}
                    </span>
                    <span class="detail-item">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
                            <line x1="16" y1="2" x2="16" y2="6"/>
                            <line x1="8" y1="2" x2="8" y2="6"/>
                            <line x1="3" y1="10" x2="21" y2="10"/>
                        </svg>
                        {{ matchSetup()!.date }} {{ matchSetup()!.time }}
                    </span>
                </div>
            </div>
            <button (click)="handleReset()" class="btn-reset">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M21.5 2v6h-6M2.5 22v-6h6M2 11.5a10 10 0 0 1 18.8-4.3M22 12.5a10 10 0 0 1-18.8 4.2"/>
                </svg>
                Reset Match
            </button>
        </div>

        <!-- Innings Selector -->
        <div class="innings-selector">
            <button (click)="switchInnings(1)" [class.active]="currentInnings() === 1" class="innings-btn">
                <div class="innings-name">1st Innings: {{ matchSetup()!.team1 }}</div>
                <div class="innings-score">{{ calculateInningsTotal(1).runs }}/{{ calculateInningsTotal(1).wickets }}
                    ({{ calculateInningsTotal(1).overs }})</div>
            </button>
            <button (click)="switchInnings(2)" [class.active]="currentInnings() === 2" class="innings-btn">
                <div class="innings-name">2nd Innings: {{ matchSetup()!.team2 }}</div>
                <div class="innings-score">{{ calculateInningsTotal(2).runs }}/{{ calculateInningsTotal(2).wickets }}
                    ({{ calculateInningsTotal(2).overs }})</div>
            </button>
        </div>

        <!-- Score Display -->
        <app-score-summary
            [battingTeam]="getBattingTeam()"
            [bowlingTeam]="getBowlingTeam()"
            [runs]="calculateInningsTotal(currentInnings()).runs"
            [wickets]="calculateInningsTotal(currentInnings()).wickets"
            [overs]="calculateInningsTotal(currentInnings()).overs"
            [runRate]="getRunRate(currentInnings())"
            [target]="getTarget()"
            [matchResult]="getMatchResult()">
        </app-score-summary>

        <div class="score-card">
            <!-- Current Over Info -->
            <div *ngIf="currentInningsData().showBowlerInput" class="bowler-input-box">
                <h3 class="over-title">Over {{ currentInningsData().currentOver.overNo }}</h3>
                <div class="bowler-input-row">
                    <input type="text" [(ngModel)]="currentInningsData().currentOver.bowlerName"
                        placeholder="Enter bowler name"
                        class="bowler-input" />
                    <button (click)="handleBowlerSubmit()" class="btn-start-over">Start Over</button>
                </div>
            </div>

            <!-- Current Over Display -->
            <div *ngIf="!currentInningsData().showBowlerInput">
                <app-over-card
                    [over]="currentInningsData().currentOver"
                    [isCompleted]="false">
                </app-over-card>

                <!-- Edit Bowler Button -->
                <button (click)="editCurrentBowler()" class="btn-edit-bowler">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/>
                        <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/>
                    </svg>
                    Edit Bowler
                </button>
            </div>

            <!-- Ball Input Buttons -->
            <app-ball-controls
                *ngIf="!currentInningsData().showBowlerInput"
                (ballAdded)="handleBallInput($event)"
                (undoRequested)="deleteLastBall()">
            </app-ball-controls>
        </div>

        <!-- Completed Overs -->
        <div *ngIf="currentInningsData().overs.length > 0" class="completed-overs">
            <div class="completed-header">
                <h2 class="completed-title">Completed Overs</h2>
                <button (click)="editLastCompletedOver()" class="btn-edit-last-over">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/>
                        <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/>
                    </svg>
                    Edit Last Over
                </button>
            </div>
            <div class="overs-list">
                <app-over-card
                    *ngFor="let over of currentInningsData().overs.slice().reverse()"
                    [over]="over"
                    [isCompleted]="true">
                </app-over-card>
            </div>
        </div>

    </div>
</div>